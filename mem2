local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local leaderName = "pandaboiis58"

local PLACE_ID_TARGET = 4310463616
local JOB_ID_TARGET   = "58ae3c9c-5687-4ee1-9d40-b71f78492a34"

local Parties = ReplicatedStorage:FindFirstChild("Parties")
if not Parties then
    warn("Không tìm thấy thư mục Parties trong ReplicatedStorage.")
    return
end

-- Kiểm tra LocalPlayer đã trong party chưa
local function isLocalPlayerInParty()
    for _, party in ipairs(Parties:GetChildren()) do
        local membersFolder = party:FindFirstChild("Members")
        if membersFolder and membersFolder:IsA("Folder") then
            if membersFolder:FindFirstChild(LocalPlayer.Name) then
                return true
            end
        end
    end
    return false
end

while true do
    task.wait(5)

    -- Nếu chưa có trong party thì auto accept invite từ leader
    if not isLocalPlayerInParty() then
        local leaderPlayer = Players:FindFirstChild(leaderName)
        if leaderPlayer then
            local args = {
                [1] = leaderPlayer
            }
            ReplicatedStorage:WaitForChild("Shared")
                :WaitForChild("Party")
                :WaitForChild("AcceptedInvite")
                :FireServer(unpack(args))
        end

        -- Sau khi accept (hoặc không thấy leader), kiểm tra placeId & jobId
        if game.PlaceId ~= PLACE_ID_TARGET then
            -- Chưa ở place mục tiêu => Teleport tới
            TeleportService:Teleport(PLACE_ID_TARGET, LocalPlayer)
        else
            -- Đang ở place 4310463616
            if game.JobId == JOB_ID_TARGET then
                -- Đã ở đúng jobId => dừng lại để chờ được mời vào party
                print("Đã ở place 4310463616 và jobId chỉ định. Chờ được mời...")
                break
            else
                -- Ở 4310463616 nhưng chưa đúng job => Teleport đến job đích
                TeleportService:TeleportToPlaceInstance(PLACE_ID_TARGET, JOB_ID_TARGET, LocalPlayer)
            end
        end

    else
        -- Đã ở trong party, không cần làm gì
        print("Bạn đã ở trong party.")
    end
end
